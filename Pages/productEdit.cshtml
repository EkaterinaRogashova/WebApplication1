@page "/edit/{id}"
@{
    ViewData["Title"] = "Редактирование товара";
}

<div class="container mt-4">
    <h2>Редактирование товара</h2>

    <form id="editForm">
        <input type="hidden" id="productId" />

        <div class="form-group">
            <label for="productName">Название товара</label>
            <input type="text" class="form-control" id="productName" required>
        </div>

        <div class="form-group">
            <label for="productPrice">Цена</label>
            <input type="number" step="0.01" class="form-control" id="productPrice" required>
        </div>

        <button type="submit" class="btn btn-primary">Сохранить</button>
    </form>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Получаем ID из URL
            const pathArray = window.location.pathname.split('/');
            const productId = pathArray[pathArray.length - 1];
            document.getElementById('productId').value = productId;

            // Загружаем данные товара
            fetch(`http://localhost:3000/products/${productId}`)
                .then(response => response.json())
                .then(product => {
                    document.getElementById('productName').value = product.name;
                    document.getElementById('productPrice').value = product.price;
                });

            // Обработка формы
            document.getElementById('editForm').addEventListener('submit', function (e) {
                e.preventDefault();

                const updatedProduct = {
                    name: document.getElementById('productName').value,
                    price: parseFloat(document.getElementById('productPrice').value)
                };

                fetch(`http://localhost:3000/products/${productId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(updatedProduct)
                })
                    .then(response => {
                        if (response.ok) {
                            window.location.href = '/'; // Возвращаемся на главную после сохранения
                        }
                    });
            });
        });
    </script>
}